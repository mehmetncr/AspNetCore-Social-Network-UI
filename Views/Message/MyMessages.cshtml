@model List<MessageViewModel>
@{
    ViewData["Title"] = "MyMassages";
    Layout = "~/Views/Shared/LayoutPage.cshtml";
}


<!--Profile Top Nav-->
<vc:profile-nav></vc:profile-nav>
<!--Profile Top Nav-->

<section>
    <div class="gap gray-bg">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="row" id="page-contents">
                        <div class="col-lg-3">
                            <aside class="sidebar static">
                                <!--ShortCuts-->
                                <partial name="ShortCutsPartialView" />
                                <!--ShortCuts-->
                            </aside>
                        </div><!-- sidebar -->
                        <div class="col-lg-6">
                            <div class="central-meta">
                                <div class="messages">
                                    <h5 class="f-title"><i class="ti-comments-smiley"></i>Tüm Mesajlar</h5>
                                    <div class="message-box">
                                        <ul class="peoples">
                                            @foreach (var message in Model)
                                            {
                                                <li>

                                                    <figure>
                                                        <img src=@message.User.UserProfilePicture alt="">
                                                        <span class="status f-@(message.User.UserIsOnline?"online":"off")"></span>
                                                    </figure>
                                                    <div class="people-name" onclick="messageFriend('@message.Id')">
                                                        <span>@message.User.UserFirstName @message.User.UserLastName</span>
                                                    </div>
                                                </li>
                                            }

                                        </ul>
                                        <div class="peoples-mesg-box">

                                            <div class="conversation-head">
                                                <figure><img src="images/resources/friend-avatar.jpg" alt=""></figure>
                                                <span>jason bourne <i>online</i></span>
                                            </div>
                                            <ul id="deneme" class="chatting-area" style="height:1000px">
                                                @foreach (var chat in Model)
                                                {
                                                    @foreach (var message in chat.MessageDetails)
                                                    {
                                                        if (ViewBag.userId == message.OwnerUserId)
                                                        {
                                                            <li class="me">
                                                                <figure><img src="~/SocialUI/images/resources/userlist-1.jpg" alt=""></figure>
                                                                <p>@message.MessageContent<span style="float:right; font-size:12px;">@message.SendDate</span></p>

                                                            </li>
                                                        }
                                                        else
                                                        {
                                                            <li class="you">
                                                                <figure><img src="~/SocialUI/images/resources/userlist-2.jpg" alt=""></figure>
                                                                <p>@message.MessageContent<span style="float:right; font-size:12px;">@message.SendDate</span></p>
                                                            </li>
                                                        }

                                                    }
                                                }
                                            </ul>
                                            <div class="message-text-container">
                                                <form method="post">
                                                    <textarea></textarea>
                                                    <button title="send"><i class="fa fa-paper-plane"></i></button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- centerl meta -->
                        <div class="col-lg-3">
                            <aside class="sidebar static">

                            </aside>
                        </div><!-- sidebar -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



@section Scripts {
    <script>
        var model = @Html.Raw(Json.Serialize(Model));
        var userId = @ViewBag.userId;

        function messageFriend(id) {
            debugger;
            model.forEach(function (message) {
                
                if (message.id == id) {
                    var messages = message;
                    $(".chatting-area").empty();
                    var messageHtml = '';

                    messages.messageDetails.forEach(function (chat) {
                        debugger;
                        var isMyMessage = chat.ownerUserId == userId;
                        console.log(chat.ownerUserId);
                        console.log(userId);
                        console.log(isMyMessage);
                        var messageClass = isMyMessage ? "me" : "you";
                        var messageContent = chat.messageContent;
                        var sendDate = chat.sendDate;
                        var formattedMessageContent = messageContent.replace(/(.{50})/g, "$1<br>");
                        var imageSource = `~/SocialUI/images/resources/${isMyMessage ? 'userlist-1.jpg' : 'userlist-2.jpg'}`;
                        if (chat.ownerUserId == userId) {
                            messageHtml += `
                                            <li class="me">
                                                <figure><img src="${imageSource}" alt=""></figure>
                                                <p>${formattedMessageContent}<span style="float:right; font-size:12px;">${sendDate}</span></p>
                                            </li>`;
                        }
                        else {
                            messageHtml += `
                                                    <li class="you">
                                                        <figure><img src="${imageSource}" alt=""></figure>
                                                        <p>${formattedMessageContent}<span style="float:right; font-size:12px;">${sendDate}</span></p>
                                                    </li>`;
                        }



                    });

                    $(".chatting-area").append(messageHtml);
                }
            });
        };

    </script>
}
